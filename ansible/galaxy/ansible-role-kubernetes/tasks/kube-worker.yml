---

- name: Check if kubelet.conf exists
  stat:
    path: "/etc/kubernetes/kubelet.conf"
  register: kubelet_conf

- name: "kubeadm join node {{ inventory_hostname }} to {{ hostvars[groups['kube-control-plane'][0]].ansible_host }}"
  command: |
    kubeadm join --token {{ kube_token }} \
    --discovery-token-unsafe-skip-ca-verification \
    {{ hostvars[groups['kube-control-plane'][0]].ansible_host }}:6443
  register: kubeadm_join_command
  when: not kubelet_conf.stat.exists

- name: "Output kubeadm join {{ inventory_hostname }}" 
  debug:
    msg: "{{ kubeadm_join_command.stdout_lines }}"
  register: not kubelet_conf.stat.exists